= form_for [@subscription_plan, @subscriber] do |f|
  = f.error_messages

  = field_set_tag  @subscriber.customer.full_name do
    .splitContainer
      %dl.third
        %dt= f.label :balance,  t('shoppe.subscribers.balance')
        %dd
          .moneyInput
            .currency= Shoppe.settings.currency_unit.html_safe
            = f.text_field :balance, :class => 'text'
        %dt= f.label :has_migrated, t('shoppe.subscribers.has_migrated')
        %dd.checkbox
          = f.check_box :has_migrated
      %dl.third
        %dt= f.label :subscription_plan,  t('shoppe.subscribers.subscription_plan')
        %dd
          = f.collection_select :subscription_plan_id, @subscription_plans, :id, :api_plan_id, {include_blank: true}, {class: 'chosen-with-deselect', data: {placeholder: t('shoppe.subscription_plans.select_subscription_plan')}}
          %p.help=  t('shoppe.subscription_plans.stripe_subscription_plan_id')
      %dl.third
        %dt= f.label :stripe_id,  t('shoppe.subscribers.stripe_id')
        %dd
          = f.text_field :stripe_id, {:class => 'text'}
          %p.help=  t('shoppe.subscription_plans.stripe_subscription_plan_id')

  = field_set_tag  t('shoppe.subscribers.recipient_details') do
    .splitContainer
      %dl.half
        %dt= f.label :recipient_name,  t('shoppe.subscribers.recipient_name')
        %dd
          = f.text_field :recipient_name, {:class => 'text'}
          %p.help=  t('shoppe.subscribers.subscriber_recipient_name')
      %dl.half
        %dt= f.label :recipient_email,  t('shoppe.subscribers.recipient_email')
        %dd
          = f.text_field :recipient_email, {:class => 'text'}

  = field_set_tag  t('shoppe.subscribers.recipient_details') do
    .splitContainer
      %dl.half
        %dt= f.label :recipient_phone,  t('shoppe.subscribers.recipient_phone')
        %dd
          = f.text_field :recipient_phone, {:class => 'text'}
      %dl.half
        %dt= f.label :delivery_address
        %dd
          = f.collection_select :delivery_address_id, @subscriber.customer.addresses, :id, :full_address, {include_blank: true}, {class: 'chosen-with-deselect', data: {placeholder: t('shoppe.subscription_plans.select_recipient_address')}}
          %p.help=  t('shoppe.subscription_plans.recipient_delivery_address')

  = field_set_tag t('shoppe.subscribers.blocked_products') do
    %dl
      %dd
        = f.collection_select :blocked_product_ids, @all_variants, :id, :name, {}, {:class => 'chosen', :multiple => true, :data => {:placeholder => t('shoppe.orders.products')}, selected: @subscriber.blocked_products.map(&:id)}
        %p.help= t('shoppe.subscribers.blocked_products_help')

  = field_set_tag t('shoppe.subscribers.status') do
    .splitContainer
      %dl.half
        %dt= f.label :created_at, t('shoppe.subscribers.start_date')
        %dd
          = @subscriber.created_at
      %dl.half
        %dt= f.label :created_at, t('shoppe.subscribers.cancelled_date')
        %dd
          = @subscriber.cancelled_at

  %p.submit
    - unless @subscriber.new_record?
      - if @subscriber.cancelled_at.blank? and @subscriber.subscription_plan.present?
        %span.right
          = link_to t('shoppe.subscribers.cancel'),
                    [@subscription_plan, @subscriber],
                    class: 'button purple',
                    method: :delete,
                    data: {confirm: t('shoppe.subscribers.delete_confirmation')}
    = f.submit t('shoppe.subscribers.save'),
               class: 'button green',
               data: {disable_with: (@subscriber.new_record? ? t('shoppe.subscribers.creating_subscriber') : t('shoppe.subscribers.updating_subscriber'))}
    = link_to t('shoppe.subscribers.cancel'), [@subscription_plan, :subscribers], :class => 'button'
